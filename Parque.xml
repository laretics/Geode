<?xml version="1.0" encoding="utf-8" ?>
<!-- 30-09-2025 -->
<mtfComm title="Parque vaporista de Mallorca" version ="2.0" hversion="1.5">
	<users>
		<user id="0" name="root" pwd="qwer" level="255"/>
		<user id="1" name="xisco" pwd="xisco" level="1"/>
		<user id="2" name="roberto" pwd="roberto" level="1"/>
		<user id="3" name="matias" pwd="corea69" level="2"/>
		<user id="4" name="domingo" pwd="domingo69" level="2"/>
		<user id="5" name="guest" pwd="guest" level="1"/>
	</users>
	<views>		
		<view id="0" name="CTC" comment="Vista principal del enclavamiento a nivel de CTC"
			  x="-100" y="0" w="800" h="400" scale="50" icon="0"/>
		<view id="1" name="Marratxinet" comment="Estación de Marratxinet desde las avanzadas en los túneles hasta los circuitos de salida"
			  x="-20" y="0" w="1000" h="350" scale="100" icon="1"/>
		<view id="2" name="Contenedor" comment="Estación secundaria junto a la Landaluce"
			  x="700" y="300" w="900" h="550" scale="100" icon="1"/>
		<view id="3" name="Deposito" comment="Zona de vías entre la salida de Marratxinet y el triángulo"
			  x="280" y="0" w="900" h="700" scale ="100" icon="1"/>			  
		<view id="4" name="CTC-W" comment="Vista completa para pantallas panorámicas"
			  x="-100" y="0" w="1600" h="800" scale="80" icon="0"/>
	</views>
	<topology>
		<!-- Signals-->
		<signal id="1" name="AI1" x="22" y="300" shunt="false" orientation ="north"/>
		<signal id="2" name="A1" x="87" y="300" shunt="false" orientation ="north"/>
		<signal id="4" name="E1" x="87" y="225" shunt="true" orientation ="north" advance="A1" circuit="C04"/>
		<signal id="5" name="S1" x="548" y="200" shunt="false" orientation="east" circuit="C06"/>
		<signal id="6" name="S2" x="548" y="175" shunt="false" orientation="east" circuit="C06"/>
		<signal id="7" name="S3" x="548" y="150" shunt="false" orientation="east" circuit="C08"/>
		<signal id="8" name="S4" x="548" y="125" shunt="false" orientation="east" circuit="C08"/>
		<signal id="9" name="I1" x="548" y="90" shunt="false" orientation="east" circuit="C07" advance="AI1"/>
		<!-- Sections-->
		<section id="1" name="C01"/>
		<section id="2" name="C02"/>
		<crossing id="1" name="PN1"/>
		<section id="4" name="C04"/>
		<section id="5" name="M4"/>
		<section id="6" name="M3"/>
		<section id="7" name="M2"/>
		<section id="8" name="M1"/>
		<section id="10" name="C08" />
		<section id="11" name="C07"/>
		<section id="12" name="C06"/>
		<section id="13" name="C09" disabled="true"/>
		<section id="14" name="C10" disabled="true"/>
		<section id="15" name="C11"/>
		<section id="16" name="C12"/>
		<section id="17" name="C13" disabled="true"/>
		<section id="18" name="C14"/>
		<section id="19" name="C15"/>
		<section id="20" name="C16" disabled ="true"/>
		<section id="21" name="C17" />
		<crossing x="1300" y="413" l="20" id="2" name="PN2" orientation="north"/>
		<section id="22" name="C18" />
		<section id="23" name="C19"/>
		<section id="24" name="C20" disabled="true"/>					
		<signal id="10" name="A21" x="1387" y="425" shunt="false" orientation ="east"/>
		<section id="25" name="C21"/>
		<section id="26" name="CN1"/>
		<section id="27" name="CN2"/>
		<section id="28" name="C22"/>
		<signal id="11" name="E21" x="1357" y="660" shunt="true" circuit="C21" orientation ="west" advance="A21"/>
		<signal id="12" name="E22" x="1357" y="697" shunt="true" circuit="C21" orientation ="west"/>		
		<signal id="13" name="S21" x="1028" y="660" circuit="C22" orientation ="west"/>
		<signal id="14" name="S22" x="1028" y="697" circuit="C22" orientation ="west"/>
		<section id="29" name="C23"/>
		<section id="30" name="C24"/>
	</topology>		
	<itineraries>
		<!-- Descripción de los posibles itinerarios que se pueden crear con este enclavamiento -->		
		<itin id="SHC02M1" name="Entrada maniobra vía 1" group="Entradas" origin="E1" destination="M1" key="E1,M1" shunting="true">
			<pre ckfree="C04"/>
			<chg>
				<pos cir="C04" set="0"/>
				<signal id="A1" set="stopAdvice"/>
				<signal id="E1" set="override"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M1"/>
		</itin>
		<itin id="C02M1" name="Entrada vía 1" group="Entradas" origin="E1" destination="M1" key="E1,M1">
			<pre ckfree="C04,M1"/>
			<chg>
				<pos cir="C04" set="0"/>
				<signal id="A1" set="free"/>
				<signal id="E1" set="stopAdvice"/>
				<signal id="S1" set="stop"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M1"/>
		</itin>
		<itin id="M1C06" name="Salida vía 1" group="Salidas" origin="M1" destination="S1" key="S1,C17">
			<pre ckfree="C06,C12,C14,C15"/>
			<chg>
				<pos cir="C06" set="0"/>
				<pos cir="C12" set="0"/>
				<pos cir="C14" set="0"/>
				<pos cir="C15" set="1"/>
				<signal id="S1" set="free"/>
			</chg>
			<post setlock="C06,C12,C14,C15"/>
		</itin>
		<itin id="C02M1C06" name="Paso directo vía 1" group="Pasos" origin="E1" destination="S1" key="E1,S1,C17">
			<pre ckfree="C04,M1,C06,C12,C14,C15"/>
			<chg>
				<pos cir="C04" set="0"/>
				<pos cir="C06" set="0"/>
				<pos cir="C12" set="0"/>
				<pos cir="C14" set="0"/>
				<pos cir="C15" set="1"/>
				<signal id="A1" set="free"/>
				<signal id="E1" set="free"/>
				<signal id="S1" set="free"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M1,C06,C12,C14,C15"/>
		</itin>
		<itin id="C02M2" name="Entrada vía 2" group="Entradas" origin="E1" destination="M2" key="E1,M2">
			<pre ckfree="C04,M2"/>
			<chg>
				<pos cir="C04" set="1"/>
				<signal id="A1" set="warning"/>
				<signal id="E1" set="stopAdvice"/>
				<signal id="S2" set="stop"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M2"/>
		</itin>
		<itin id="M2C06" name="Salida vía 2" group="Salidas" origin="M2" destination="S2" key="S2,C17">
			<pre ckfree="C06,C12,C14,C15"/>
			<chg>
				<pos cir="C06" set="1"/>
				<pos cir="C12" set="0"/>
				<pos cir="C14" set="0"/>
				<pos cir="C15" set="1"/>
				<signal id="S2" set="free"/>
			</chg>
			<post setlock="C06,C12,C14,C15"/>
		</itin>
		<itin id="C02M2C06" name="Paso directo vía 2" group="Pasos" origin="E1" destination="S2" key="E1,S2,C17">
			<pre ckfree="C04,M2,C06,C12,C14,C15"/>
			<chg>
				<pos cir="C04" set="1"/>
				<pos cir="C06" set="1"/>
				<pos cir="C12" set="0"/>
				<pos cir="C14" set="0"/>
				<pos cir="C15" set="1"/>
				<signal id="A1" set="warning"/>
				<signal id="E1" set="warning"/>
				<signal id="S2" set="free"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M2,C06,C12,C14,C15"/>
		</itin>
		<itin id="C01M3" name="Entrada vía 3" group="Entradas" origin="E1" destination="M3" key="E1,M3">
			<pre ckfree="C04,M3"/>
			<chg>
				<pos cir="C04" set="2"/>
				<signal id="A1" set="warning"/>
				<signal id="E1" set="stopAdvice"/>
				<signal id="S3" set="stop"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M3"/>
		</itin>
		<itin id="M3C08" name="Salida vía 3" group="Salidas" origin="M3" destination="S3" key="S3,C17">
			<pre ckfree="C08,C11,C15"/>
			<chg>
				<pos cir="C08" set="1"/>
				<pos cir="C11" set="1"/>
				<pos cir="C15" set="0"/>
				<signal id="S3" set="free"/>
			</chg>
			<post setlock="C08,C11,C15"/>
		</itin>
		<itin id="C01M3C08" name="Paso directo vía 3" group="Pasos" origin="E1" destination="S3" key="E1,S3,C17">
			<pre ckfree="C04,M3,C08,C11,C15"/>
			<chg>
				<pos cir="C04" set="2"/>
				<pos cir="C08" set="1"/>
				<pos cir="C11" set="1"/>
				<pos cir="C15" set="0"/>
				<signal id="A1" set="warning"/>
				<signal id="E1" set="warning"/>
				<signal id="S3" set="free"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M3,C08,C11,C15"/>
		</itin>
		<itin id="C01M4" name="Entrada vía 4" group="Entradas" origin="E1" destination="M4" key="E1,M4">
			<pre ckfree="C04,M4"/>
			<chg>
				<pos cir="C04" set="3"/>
				<signal id="A1" set="warning"/>
				<signal id="E1" set="stopAdvice"/>
				<signal id="S4" set="stop"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M4"/>
		</itin>
		<itin id="M4C08" name="Salida vía 4" group="Salidas" origin="M4" destination="S4" key="S4,C17">
			<pre ckfree="C08,C11,C15"/>
			<chg>
				<pos cir="C08" set="0"/>
				<pos cir="C11" set="1"/>
				<pos cir="C15" set="0"/>
				<signal id="S4" set="free"/>
			</chg>
			<post setlock="C08,C11,C15"/>
		</itin>		
		<itin id="C01M4C08" name="Paso directo vía 4" group="Pasos" origin="E1" destination="S4" key="E1,S4,C17">
			<pre ckfree="C04,M4,C08,C11,C15"/>
			<chg>
				<pos cir="C04" set="3"/>
				<pos cir="C08" set="0"/>
				<pos cir="C11" set="1"/>
				<pos cir="C15" set="0"/>
				<signal id="A1" set="warning"/>
				<signal id="E1" set="free"/>
				<signal id="S4" set="free"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C04,M4,C08,C11,C15"/>
		</itin>
		<itin id="C01C05C07" name="Paso directo vía 5" group="Pasos" origin="AI1" destination="I1" key="AI1,I1,C17">
			<pre ckfree="C01,C07,C11,C15"/>
			<chg>
				<pos cir="C11" set="0"/>
				<pos cir="C15" set="0"/>
				<signal id="AI1" set="free"/>
				<signal id="I1" set="free"/>
				<crossing id="PN1" set="close"/>
			</chg>
			<post setlock="C01,C07,C11,C15"/>
		</itin>
		<itin id="C05C07" name="Salida vía 5" group="Salidas" origin="I1" destination="C07" key="I1,C17">
			<pre ckfree="C07,C11,C15"/>
			<chg>
				<pos cir="C11" set="0"/>
				<pos cir="C15" set="0"/>
				<signal id="I1" set="free"/>
			</chg>
			<post setlock="C07,C11,C15"/>
		</itin>
		<itin id="C17E21" name="Entrada Container" group="Entradas" origin="C17" destination="E21" key="C17,E21">
			<pre ckfree="C17,C18,C19"/>
			<chg>
				<pos cir="C17" set="1"/>
			</chg>
			<post setlock="C17,C18,C19"/>
		</itin>
		<itin id="C17CN1" name="Entrada Container V1" group="Entradas" origin="C17" destination="CN1" key="C17,CN1">
			<pre ckfree="C17,C18,C19,C21,CN1"/>
			<chg>
				<pos cir="C17" set="1"/>
				<pos cir="C21" set="0"/>
				<signal id="A21" set="free"/>
				<signal id="E21" set="stopAdvice"/>
			</chg>
			<post setlock="C17,C18,C19,C21,CN1"/>
		</itin>
		<itin id="E22CN2" name="Entrada Container V2" group="Entradas" origin="E22" destination="CN2" key="E22,CN2">
			<pre ckfree="C17,C18,C19,C21,CN2"/>
			<chg>
				<pos cir="C21" set="1"/>
				<signal id="E22" set="stopAdvice"/>
			</chg>
			<post setlock="C21,CN2"/>
		</itin>
		<itin id="C17CN2" name="Entrada Container V2 (Desviada)" group="Entradas" origin="C17" destination="CN2" key="C17,CN2">
			<pre ckfree="C17,C18,C19,C21,CN2"/>
			<chg>
				<pos cir="C17" set="1"/>
				<pos cir="C21" set="2"/>
				<signal id="A21" set="warning"/>
				<signal id="E21" set="stopAdvice"/>
			</chg>
			<post setlock="C17,C18,C19,C21,CN2"/>
		</itin>
		<itin id="CN1C24" name="Salida Container V1" group="Salidas" origin="CN1" destination="S21" key="CN1,C24">
			<pre ckfree="C22,C24"/>
			<chg>
				<pos cir="C22" set="0"/>
				<pos cir="C24" set="0"/>
				<signal id="S21" set="free"/>
			</chg>
			<post setlock="C22,C24"/>
		</itin>
		<itin id="CN2C22" name="Salida Container V2" group="Salidas" origin="CN2" destination="S22" key="CN2,C22">
			<pre ckfree="C22"/>
			<chg>
				<pos cir="C22" set="1"/>
				<signal id="S22" set="free"/>
			</chg>
			<post setlock="C22"/>
		</itin>
		<itin id="CN2C22C24" name="Salida Container V2 (Desviada)" group="Salidas" origin="CN2" destination="C24" key="CN2,C22,C24">
			<pre ckfree="C22,C24"/>
			<chg>
				<pos cir="C22" set="2"/>
				<signal id="S22" set="warning"/>
			</chg>
			<post setlock="C22,C24"/>
		</itin>
		<itin id="C17C24" name="Paso Container V1" group="Pasos" origin="C17" destination="S21" key="C17,CN1,C24">
			<pre ckfree="C17,C18,C19,C21,CN1,C22,C24"/>
			<chg>
				<pos cir="C17" set="1"/>
				<pos cir="C21" set="0"/>
				<pos cir="C22" set="0"/>
				<pos cir="C24" set="0"/>
				<signal id="A21" set="free"/>
				<signal id="E21" set="free"/>
				<signal id="S21" set="free"/>
			</chg>
			<post setlock="C17,C18,C19,C21,CN1,C22,C24"/>
		</itin>
		<itin id="C17C24Bp" name="By Pass" group ="Pasos" origin="C17" destination="C24" key="C17,C23,C24">
			<pre ckfree="C17,C23,C24"/>
			<chg>
				<pos cir="C17" set="0"/>
				<pos cir="C24" set="1"/>
			</chg>
			<post setlock="C17,C23,C24"/>
		</itin>
	</itineraries>
	<clients>
		<client name="Empty" id="0" interface="1">
			<ethernet ip="192.168.0.254" mask="24" mac="DE:AD:BE:EF:FE:00"/>
		</client>
		<client name="mtx0" id="1" interface="1">
			<!--Armario del túnel-->
			<ethernet ip="192.168.0.10" mask="24" mac="DE:AD:BE:EF:FE:10">
				<signal id="1" name="A2" type="light" defaultOrder="stopAdvice">
					<light color="green" port="23" inverted ="false"/>
					<light color="yellow" port="25" inverted="false"/>				
				</signal>
				<signal id="2" name="A1" type="light" defaultOrder="stopAdvice">
					<light color="green" port="27" inverted ="false"/>
					<light color="yellow" port="29" inverted="false"/>
				</signal>				
			</ethernet>
		</client>
		<client name="mtx1" id="1" interface="0">
			<!--Armario de la entrada de Marratxinet-->
			<ethernet ip="192.168.0.11" mask="24" mac="DE:AD:BE:EF:FE:01"/>
			<signal id="3" name="E2" type="light" defaultOrder="stop">
				<light color="green" port="25" inverted="true"/>
				<light color="red" port="24" inverted="false"/>
				<light color="yellow" port="27" inverted="true"/>
				<light color="white" port="26" inverted="true"/>							
			</signal>																			
			<signal id="4" name="E1" type="light" defaultOrder="stop">
				<light color="green" port="29" inverted="true"/>
				<light color="red" port="28" inverted="false"/>
				<light color="yellow" port="31" inverted="true"/>
				<light color="white" port="30" inverted="true"/>							
			</signal>
			<layout id="1" name="c03" sequential="true">
				<frogs>
					<frog id="0" timeout="250">
						<l298n enable="32" a="33" b="34"/>
					</frog>
					<frog id="1" timeout="250">
						<l298n enable="35" a="36" b="37"/>
					</frog>
				</frogs>
				<itins>
					<itin id="0" name="Paso directo c05">
						<frog id="0" rect="true"/>
					</itin>
					<itin id="1" name="Entrada a via 3">
						<frog id="0" rect="false"/>
						<frog id="1" rect="true"/>
					</itin>
					<itin id="1" name="Entrada a via 4">
						<frog id="0" rect="false"/>
						<frog id="1" rect="false"/>
					</itin>
				</itins>
			</layout>
			<layout id="2" name="c04" sequential="true">
				<frogs>
					<frog id="0" timeout="10">
						<l298n enable ="38" a="39" b="40"/>
					</frog>
				</frogs>
				<itins>
					<itin id="0" name="Entrada a via 1">
						<frog id="0" rect="true"/>
					</itin>
					<itin id="1" name="Entrada a via 2">
						<frog id="0" rect="false"/>
					</itin>
				</itins>
			</layout>
		</client>
		<client name="mtx2" id="2" interface="1">
			<!--Pórtico de señales-->
			<ethernet ip="192.168.0.12" mask="24" mac="DE:AD:BE:EF:FE:02"/>
			<signal id="9" name="I1" type="semaphore" defaultOrder="stop">
				<light color="red" port="27" inverted ="true"/>
				<light color="green" port="26" inverted ="false"/>				
				<servo port="A5" stopAngle="290" allowAngle="80" tomeu="true" dynamic="true" speed="1"/>
			</signal>
			<signal id="5" name="S1" type="semaphore" defaultOrder="stop">
				<light color="red" port="23" inverted ="true"/>
				<light color="green" port="29" inverted ="false"/>				
				<servo port="A1" stopAngle="290" allowAngle="80" tomeu="true" dynamic="true" speed="1"/>
			</signal>
			<signal id="6" name="S2" type="semaphore" defaultOrder="stop">
				<light color="red" port="25" inverted ="true"/>
				<light color="green" port="28" inverted ="false"/>				
				<servo port="A2" stopAngle="280" allowAngle="70" tomeu="true" dynamic="true" speed="1"/>
			</signal>
			<signal id="7" name="S3" type="semaphore" defaultOrder="stop">
				<light color="red" port="24" inverted ="true"/>
				<servo port="A3" stopAngle="286" allowAngle="90" tomeu="true" dynamic="true" speed="1"/>
			</signal>
			<signal id="8" name="S4" type="semaphore" defaultOrder="stop">
				<light color="red" port="22" inverted ="true"/>
				<servo port="A4" stopAngle="280" allowAngle="70" tomeu="true" dynamic="true" speed="1"/>
			</signal>
			<circuit id="3" name="m1" port="32"/>
			<circuit id="4" name="m2" port="33"/>
			<circuit id="5" name="m3" port="34"/>
			<circuit id="6" name="m4" port="35"/>
			<circuit id="7" name="c05" port="36"/>
		</client>
		<client name="mini" id="3" interface ="0">
			<ethernet ip="192.168.0.13" mask="24" mac="DE:AD:BE:EF:FE:03"/>
			<signal id="3" name="E2" type="light" defaultOrder="stop">
				<light color="green" port="30" inverted="false"/>
				<light color="red" port="31" inverted="false"/>
				<light color="yellow" port="32" inverted="false"/>
				<light color="white" port="33" inverted="false"/>
			</signal>
			<signal id="4" name="E1" type="light" defaultOrder="stop">
				<light color="green" port="22" inverted="true"/>
				<light color="red" port="23" inverted="true"/>
				<light color="yellow" port="24" inverted="true"/>
				<light color="white" port="25" inverted="true"/>
			</signal>
			<signal id="7" name="I1" type="semaphore" defaultOrder="stop">
				<servo port="A5" stopAngle="270" allowAngle="90" tomeu="false" dynamic="true" speed="1"/>
			</signal>			
			<layout id="3" name="c03" sequential="true">
				<frogs>
					<frog id="0" timeout="200">
						<l298n enable="40" a="41" b="38"/>
					</frog>
					<frog id="1" timeout="200">
						<l298n enable="37" a="39" b="36"/>
					</frog>
				</frogs>
				<itins>
					<itin id="0" name="Paso directo c05">
						<frog id="0" rect="true"/>
					</itin>
					<itin id="1" name="Entrada a via 3">
						<frog id="0" rect="false"/>
						<frog id="1" rect="true"/>
					</itin>
					<itin id="1" name="Entrada a via 4">
						<frog id="0" rect="false"/>
						<frog id="1" rect="false"/>
					</itin>
				</itins>
			</layout>
		</client>
	</clients>
</mtfComm>
